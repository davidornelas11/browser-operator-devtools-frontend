# Copyright 2025 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("../../../scripts/build/ninja/devtools_entrypoint.gni")
import("../../../scripts/build/ninja/devtools_pre_built.gni")
import("../visibility.gni")

devtools_pre_built("mcp-sdk") {
  sources_are_release = false

  sources = [
    # TypeScript configuration
    "mcp-sdk-tsconfig.json",
    
    # AJV JSON Schema validator (dependency)
    "ajv/dist/ajv.d.ts",
    "ajv/dist/ajv.js",
    "ajv/dist/ajv.bundle.js",
    "ajv/dist/ajv-esm.js",
    "ajv/package.json",
    
    # Zod schema validation library (dependency)
    "zod/index.d.ts",
    "zod/lib/index.js",
    "zod/lib/index.mjs",
    "zod/zod-esm.js",
    # Compat wrapper for environments that resolve relative imports under dist/
    "dist/zod/zod-esm.js",
    "zod/package.json",
    
    # Main MCP SDK files (new dist/esm location with patches)
    "dist/esm/client/auth.d.ts",
    "dist/esm/client/auth.js",
    "dist/esm/client/index.d.ts",
    "dist/esm/client/index.js",
    "dist/esm/client/sse.d.ts",
    "dist/esm/client/sse.js",
    "dist/esm/client/streamableHttp.d.ts",
    "dist/esm/client/streamableHttp.js",
    "dist/esm/server/index.d.ts",
    "dist/esm/server/index.js",
    "dist/esm/server/auth/errors.d.ts",
    "dist/esm/server/auth/errors.js",
    "dist/esm/shared/auth.d.ts",
    "dist/esm/shared/auth.js",
    "dist/esm/shared/auth-utils.d.ts",
    "dist/esm/shared/auth-utils.js",
    "dist/esm/shared/transport.d.ts",
    "dist/esm/shared/transport.js",
    "dist/esm/shared/protocol.d.ts",
    "dist/esm/shared/protocol.js",
    "dist/esm/types.d.ts",
    "dist/esm/types.js",
    
    # EventSource parser dependency
    "eventsource-parser/package/dist/index.d.ts",
    "eventsource-parser/package/dist/index.js",
    "eventsource-parser/package/dist/stream.d.ts",
    "eventsource-parser/package/dist/stream.js",
  ]
}

devtools_entrypoint("bundle") {
  entrypoint = "mcp-sdk.ts"

  deps = [ ":mcp-sdk",
    # Required by MCPOAuthProvider for navigation & URL monitoring
    "../../core/sdk:bundle",
    "../../core/platform:bundle",
  ]

  visibility = [
    "../../panels/ai_chat/*",
  ]

  visibility += devtools_third_party_visibility
}

devtools_entrypoint("bundle_v2") {
  entrypoint = "mcp-sdk-v2.ts"

  deps = [ ":mcp-sdk",
    "../../core/sdk:bundle",
    "../../core/platform:bundle",
  ]

  visibility = [
    "../../panels/ai_chat/*",
  ]

  visibility += devtools_third_party_visibility
}
